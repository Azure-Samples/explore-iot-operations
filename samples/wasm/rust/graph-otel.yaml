metadata:
  name: "Otel graph"
  description: "A graph that transforms input data into OpenTelemetry metrics"
  version: "1.0.0"
  $schema: "https://www.schemastore.org/aio-wasm-graph-config-1.0.0.json"
  vendor: "Microsoft"

moduleConfigurations:
  - name: module-otel-transform/map
    parameters:
      metricName:
        name: metricName
        description: Explicit name for metric. If metricNamePath is given as well, this will take precedence.
      metricNamePath:
        name: metricNamePath
        description: Dot source path into payload for metric name
      metricValuePath:
        name: metricValuePath
        description: Dot source path into payload for metric value
      metricType:
        name: metricType
        description: Type for metric
      metricTimestampPath:
        name: metricTimestampPath
        description: Timestamp for metric
      metricUnits:
        name: metricUnits
        description: Units for metric
  - name: module-otel-enrich/map
    parameters:
      enrichKeys:
        name: enrichKeys
        description: Comma separated list of DSS keys which will be fetched and added as attributes

moduleRequirements:
  apiVersion: "1.1.0"
  runtimeVersion: "1.1.0"

operations:
  - operationType: "source"
    name: "source"
  - operationType: "map"
    name: "module-otel-transform/map"
    module: "otel-transform:1.0.0"
  - operationType: "map"
    name: "module-otel-enrich/map"
    module: "otel-enrich:1.0.0"
  - operationType: "sink"
    name: "sink"

connections:
  - from:
      name: "source"
    to:
      name: "module-otel-enrich/map"
  - from:
      name: "module-otel-enrich/map"
    to:
      name: "module-otel-transform/map"
  - from:
      name: "module-otel-transform/map"
    to:
      name: "sink"
